window.onload=function(){function e(){t.vignette=new PIXI.Sprite,t.card=new PIXI.Sprite(PIXI.loader.resources["img/cartes/neutre_créature_commune.png"].texture),t.gemme=new PIXI.Sprite,t.cropper=new PIXI.Sprite(PIXI.loader.resources["img/vignettes/mask.png"].texture),t.cropper.visible=!1,t.descriptionContainer=new PIXI.Container;var e={fontFamily:"BERNHC",fontSize:"72px",fontWeight:"bold",fill:"#FFF",stroke:"#04849A",strokeThickness:7};t.APText=new PIXI.Text("0",e),e.fontSize="52px",e.stroke="#895A00",e.strokeThickness=5,t.ATKText=new PIXI.Text("0",e),e.stroke="#8C0110",t.HPText=new PIXI.Text("0",e),e.stroke="#274600",t.MPText=new PIXI.Text("0",e),e={fontFamily:"BERNHC",fontSize:"36px",fontWeight:"bold",fill:"#FFF",stroke:"#000",strokeThickness:1,letterSpacing:1},t.NameText=new PIXI.Text("",e),e.fontSize="28px",t.FamilyText=new PIXI.Text("",e),t.stage.addChild(t.vignette),t.stage.addChild(t.cropper),t.stage.addChild(t.card),t.stage.addChild(t.gemme),t.stage.addChild(t.APText),t.stage.addChild(t.ATKText),t.stage.addChild(t.HPText),t.stage.addChild(t.MPText),t.stage.addChild(t.NameText),t.stage.addChild(t.FamilyText),t.stage.addChild(t.descriptionContainer),t.vignette.x=VIGNETTE_X,t.vignette.y=VIGNETTE_Y,t.vignette.scale.x=VIGNETTE_SX,t.vignette.scale.y=VIGNETTE_SY,t.card.scale.x=CARD_SX,t.card.scale.y=CARD_SY,t.APText.x=AP_X,t.APText.y=AP_Y,t.ATKText.x=ATK_X,t.ATKText.y=ATK_Y,t.HPText.x=HP_X,t.HPText.y=HP_Y,t.MPText.x=MP_X,t.MPText.y=MP_Y,t.gemme.scale.x=1.2,t.gemme.scale.y=1.2,t.updateCardImage(),t.updateGemmeImage(),t.loaded=!0,t.bar.remove()}VIGNETTE_X=66,VIGNETTE_Y=64,VIGNETTE_SX=1.87,VIGNETTE_SY=1.8,CARD_SX=.5,CARD_SY=.5,AP_X=54,AP_Y=40,ATK_X=312,ATK_Y=42,HP_X=372,HP_Y=42,MP_X=348,MP_Y=84,NAME_X=223,NAME_Y=314,FAMILY_Y=526,DESC_Y=380,$.fn.extend({animateCss:function(e){var t="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";this.addClass("animated "+e).one(t,function(){$(this).removeClass("animated "+e)})}});var t=new Vue({el:"#app",data:{loaded:!1,bar:document.getElementById("progress-bar"),vignetteBar:document.getElementById("progress-bar-v"),classes:["Neutre","Cra","Ecaflip","Eniripsa","Iop","Sacrieur","Sadida","Sram","Xelor"],rarities:["Commune","Peu commune","Rare","Krosmique","Infinite Nv1","Infinite Nv2","Infinite Nv3"],types:["Créature","Sort"],vignetteCategories:["Tokens","Neutre","Infinite","Cra","Ecaflip","Eniripsa","Iop","Sacrieur","Sadida","Sram","Xelor"],selectedType:"Créature",selectedRarity:"Commune",selectedClass:"Neutre",selectedVignetteCateg:"Tokens",selectedEffect:"",vignettesLoaded:{},vignette:{x:0,y:0,scale:{x:1,y:1}},vignettesTextures:{},vignetteCustomLink:"",cardName:"",cardExt:"",cardFamily:"",cardAtk:0,cardHP:0,cardMP:0,cardAP:0,cardDescription:"",showGameVignettes:!1,showCustomVignette:!1},methods:{getClassImg:function(){return"classe_"+this.selectedClass.toLowerCase()+".png"},getTypeImg:function(){return"type_"+this.selectedType.toLowerCase()+".png"},whenTypeSelected:function(){"Sort"===this.selectedType?(this.ATKText.visible=!1,this.HPText.visible=!1,this.MPText.visible=!1,this.vignette.y=VIGNETTE_Y-6,this.updateCropper()):(this.ATKText.visible=!0,this.HPText.visible=!0,this.MPText.visible=!0,this.vignette.y=VIGNETTE_Y),this.updateCardImage()},whenRaritySelected:function(){this.updateGemmeImage(),this.updateCardImage()},whenClassSelected:function(){this.updateCardImage()},getCardImgName:function(){return this.selectedRarity.toLowerCase().match("infinite")?this.selectedRarity.toLowerCase():this.selectedClass.toLowerCase()+"_"+this.selectedType.toLowerCase()+"_commune"},getGemmeImgName:function(){return this.selectedRarity.toLowerCase().match("infinite")?"gemme_commune":"gemme_"+this.selectedRarity.toLowerCase()},updateCardImage:function(){var e="img/cartes/"+this.getCardImgName()+".png";this.card.texture=PIXI.loader.resources[e].texture,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},updateGemmeImage:function(){var e="img/gemmes/"+this.getGemmeImgName()+".png";this.gemme.texture=PIXI.loader.resources[e].texture,this.gemme.x=NAME_X-this.gemme.width/2,this.gemme.y=e.includes("peu commune")?22:12,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenAPChanged:function(){this.APText.text=String(this.cardAP),this.cardAP>9?this.APText.x=AP_X-16:this.APText.x=AP_X,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenATKChanged:function(){this.ATKText.text=String(this.cardAtk),this.cardAtk>9?(this.ATKText.x=ATK_X-16,this.ATKText.y=ATK_Y+10,this.ATKText.style.fontSize="42px"):(this.ATKText.x=ATK_X,this.ATKText.y=ATK_Y,this.ATKText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenHPChanged:function(){this.HPText.text=String(this.cardHP),this.cardHP>9?(this.HPText.x=HP_X-16,this.HPText.y=HP_Y+10,this.HPText.style.fontSize="42px"):(this.HPText.x=HP_X,this.HPText.y=HP_Y,this.HPText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenMPChanged:function(){this.MPText.text=String(this.cardMP),this.cardMP>9?(this.MPText.x=MP_X-18,this.MPText.y=MP_Y+10,this.MPText.style.fontSize="42px"):(this.MPText.x=MP_X,this.MPText.y=MP_Y,this.MPText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenNameChanged:function(){this.NameText.text=this.cardName,this.NameText.x=NAME_X-this.NameText.width/2,this.NameText.y=NAME_Y,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenFamilyChanged:function(){this.FamilyText.text=this.cardFamily,this.FamilyText.x=NAME_X-this.FamilyText.width/2,this.FamilyText.y=FAMILY_Y,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},blankVignette:function(){this.vignette.visible=!1,this.showGameVignettes=!1,this.showCustomVignette=!1,this.renderer.render(this.stage)},gameVignettes:function(){this.showGameVignettes=!0,this.showCustomVignette=!1},customVignette:function(){this.showGameVignettes=!1,this.showCustomVignette=!0},loadVignettes:function(){for(var e=this,i=this.selectedVignetteCateg.toLowerCase(),s=document.getElementById("gameVignettes-row"),n=0;s.children.length>0;)s.removeChild(s.children[0]);if(this.cantLoadVignettes())return void this.vignettesTextures[i].forEach(function(e){var i=document.createElement("div");i.className="col-lg-2";var r=document.createElement("img");r.setAttribute("class","vignette-img"),r.setAttribute("src",e.path),i.appendChild(r),$(r).click(t.setGameVignette.bind(t,n+1)),s.appendChild(i),$(i).animateCss("fadeIn"),n++});this.vignettesTextures[i]=[];for(var r="img/vignettes/"+i+"/",a=this.getVignettesNumber(i),d=[],o=1;a>=o;o++)d.push(r+"v ("+o+").png");console.log("toLoad:",d),PIXI.loader.add(d).on("progress",function(r,a){var o=d[n];if(o){console.log("path:",o),e.vignettesTextures[i].push({texture:a,path:o});var h=document.createElement("div");h.className="col-lg-2";var g=document.createElement("img");g.setAttribute("class","vignette-img"),g.setAttribute("src",o),h.appendChild(g),$(g).click(t.setGameVignette.bind(t,n+1)),s.appendChild(h),$(h).animateCss("fadeIn"),n++,console.log("counter:",n)}}).load(function(){t.vignettesLoaded[i]=!0})},loadCustomVignette:function(){var e=this;PIXI.loader.add(this.vignetteCustomLink).load(function(){e.vignette.texture=PIXI.loader.resources[e.vignetteCustomLink].texture,e.vignette.visible=!0,e.renderer.render(e.stage),$("#render-div").animateCss("pulse")})},getVignettesNumber:function(e){switch(e){case"tokens":return 17;case"infinite":return 90;case"neutre":return 212;default:return 25}},setGameVignette:function(e){var t="img/vignettes/"+this.selectedVignetteCateg.toLowerCase()+"/",i=t+"v ("+e+").png";this.vignette.texture=PIXI.loader.resources[i].texture,this.vignette.visible=!0,this.lastVignetteIndex=e,this.updateCropper(),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},updateCropper:function(){t.cropper.visible=!1,this.vignette.mask=null,"Sort"===this.selectedType&&(t.cropper.position.x=this.vignette.x,t.cropper.position.y=this.vignette.y,t.cropper.scale.x=this.vignette.scale.x,t.cropper.scale.y=this.vignette.scale.y,t.cropper.visible=!0,this.vignette.mask=t.cropper)},cantLoadVignettes:function(){return!!this.vignettesLoaded[this.selectedVignetteCateg.toLowerCase()]},whenVignetteCoordsChanged:function(){this.updateCropper(),this.renderer.render(this.stage)},whenDescriptionChanged:function(){for(var e=this;this.descriptionContainer.children.length>0;)this.descriptionContainer.removeChild(this.descriptionContainer.children[0]);var t=this.cardDescription.split("\n"),i=0,s=0;t.forEach(function(t){i=0;var n=t.split(" "),r=[];n.forEach(function(t){var n=t.startsWith("*")&&t.endsWith("*");t=t.replace("*","").replace("*","");var a=new PIXI.Text(t,e.descriptionStyle(n));a.x=NAME_X+i,a.y=DESC_Y+s,e.descriptionContainer.addChild(a),i+=a.width+6,r.push(a)});var a=0;r.forEach(function(e){a+=e.width}),r.forEach(function(e){e.x-=a/2}),s+=22}),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},descriptionStyle:function(e){return{fontFamily:"Montserrat",fontSize:"28px",fontWeight:e?"bold":"400",fill:"#000"}},generate:function(){this.renderer.render(this.stage);var e=this.renderer.view.toDataURL(),t=document.getElementById("cardResult");t.setAttribute("src",e),$(t).animateCss("fadeIn")}}});t.renderer=PIXI.autoDetectRenderer(446,566,{transparent:!0}),t.stage=new PIXI.Container,document.getElementById("render-div").appendChild(t.renderer.view);var i=[];t.classes.forEach(function(e){t.types.forEach(function(t){["Commune"].forEach(function(s){var n="img/cartes/"+e+"_"+t+"_"+s+".png";n=n.toLowerCase(),i.push(n)})})}),i.push("img/cartes/infinite nv1.png"),i.push("img/cartes/infinite nv2.png"),i.push("img/cartes/infinite nv3.png"),i.push("img/gemmes/gemme_commune.png"),i.push("img/gemmes/gemme_peu commune.png"),i.push("img/gemmes/gemme_rare.png"),i.push("img/gemmes/gemme_krosmique.png"),i.push("img/gemmes/gemme_infinite nv1.png"),i.push("img/gemmes/gemme_infinite nv2.png"),i.push("img/gemmes/gemme_infinite nv3.png"),i.push("img/vignettes/mask.png"),PIXI.loader.add(i).on("progress",function(e,i){t.bar.style.width=e.progress+"%"}).load(e)};
