function dataURItoBlob(a){for(var b=atob(a.split(",")[1]),c=a.split(",")[0].split(":")[1].split(";")[0],d=new ArrayBuffer(b.length),e=new Uint8Array(d),f=0;f<b.length;f++)e[f]=b.charCodeAt(f);var g=new Blob([d],{type:c});return g}window.onload=function(){function d(a){if(a)e(a);else for(var b=0;b<5;b++)e(b)}function e(a){b.fireStoragePics[a].getDownloadURL().then(function(b){var c=document.getElementById("showcase-img"+a),d=c.src;c.src=b,d!==c.src&&$(c).animateCss("fadeIn")}).catch(function(a){})}function g(){b.vignette=new PIXI.Sprite,b.card=new PIXI.Sprite(PIXI.loader.resources["img/cartes/neutre_créature_commune.png"].texture),b.gemme=new PIXI.Sprite,b.cropper=new PIXI.Sprite(PIXI.loader.resources["img/vignettes/mask.png"].texture),b.cropper.visible=!1,b.descriptionContainer=new PIXI.Container;var a={fontFamily:"BERNHC",fontSize:"72px",fontWeight:"bold",fill:"#FFF",stroke:"#04849A",strokeThickness:10};b.APText=new PIXI.Text("0",a),a.fontSize="52px",a.stroke="#895A00",a.strokeThickness=7,b.ATKText=new PIXI.Text("0",a),a.stroke="#8C0110",b.HPText=new PIXI.Text("0",a),a.stroke="#274600",b.MPText=new PIXI.Text("0",a),a={fontFamily:"BERNHC",fontSize:"36px",fontWeight:"bold",fill:"#FFF",stroke:"#000",strokeThickness:1,letterSpacing:1},b.NameText=new PIXI.Text("",a),a.fontSize="28px",b.FamilyText=new PIXI.Text("",a),b.stage.addChild(b.vignette),b.stage.addChild(b.cropper),b.stage.addChild(b.card),b.stage.addChild(b.gemme),b.stage.addChild(b.APText),b.stage.addChild(b.ATKText),b.stage.addChild(b.HPText),b.stage.addChild(b.MPText),b.stage.addChild(b.NameText),b.stage.addChild(b.FamilyText),b.stage.addChild(b.descriptionContainer),b.vignette.x=VIGNETTE_X,b.vignette.y=VIGNETTE_Y,b.vignette.scale.x=VIGNETTE_SX,b.vignette.scale.y=VIGNETTE_SY,b.card.scale.x=CARD_SX,b.card.scale.y=CARD_SY,b.APText.x=AP_X,b.APText.y=AP_Y,b.ATKText.x=ATK_X,b.ATKText.y=ATK_Y,b.HPText.x=HP_X,b.HPText.y=HP_Y,b.MPText.x=MP_X,b.MPText.y=MP_Y,b.gemme.scale.x=1.2,b.gemme.scale.y=1.2,b.updateCardImage(),b.updateGemmeImage(),b.loaded=!0,b.bar.remove()}VIGNETTE_X=66,VIGNETTE_Y=64,VIGNETTE_SX=1.87,VIGNETTE_SY=1.8,CARD_SX=.5,CARD_SY=.5,AP_X=54,AP_Y=40,ATK_X=312,ATK_Y=42,HP_X=372,HP_Y=42,MP_X=348,MP_Y=84,NAME_X=223,NAME_Y=314,FAMILY_Y=526,DESC_Y=380;var a={apiKey:"AIzaSyCEfFbD2COeTd9M6zgvhIhQswdgb4vLP6U",authDomain:"krosmacreator-88989.firebaseapp.com",databaseURL:"https://krosmacreator-88989.firebaseio.com",storageBucket:"krosmacreator-88989.appspot.com",messagingSenderId:"270297341567"};firebase.initializeApp(a),$.fn.extend({animateCss:function(b){var c="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";this.addClass("animated "+b).one(c,function(){$(this).removeClass("animated "+b)})}}),$(document).on("click",".panel-heading span.panel-button",function(a){var b=$(this);b.hasClass("panel-collapsed")?(b.parents(".panel").find(".panel-body").slideDown(),b.removeClass("panel-collapsed"),b.find("i").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up")):(b.parents(".panel").find(".panel-body").slideUp(),b.addClass("panel-collapsed"),b.find("i").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down"))}),setTimeout(function(){$(".panel-button").trigger("click")},100);var b=new Vue({el:"#app",data:{loaded:!1,bar:document.getElementById("progress-bar"),vignetteBar:document.getElementById("progress-bar-v"),classes:["Neutre","Cra","Ecaflip","Eniripsa","Iop","Sacrieur","Sadida","Sram","Xelor"],rarities:["Commune","Peu commune","Rare","Krosmique","Infinite Nv1","Infinite Nv2","Infinite Nv3"],types:["Créature","Sort"],vignetteCategories:["Tokens","Neutre","Infinite","Cra","Ecaflip","Eniripsa","Iop","Sacrieur","Sadida","Sram","Xelor"],selectedType:"Créature",selectedRarity:"Commune",selectedClass:"Neutre",selectedVignetteCateg:"Tokens",selectedEffect:"",vignettesLoaded:{},vignette:{x:0,y:0,scale:{x:1,y:1}},vignettesTextures:{},vignetteCustomLink:"",cardName:"",cardExt:"",cardFamily:"",cardAtk:0,cardHP:0,cardMP:0,cardAP:0,cardDescription:"",showGameVignettes:!1,showCustomVignette:!1,refreshTextValue:60},methods:{getClassImg:function(){return"classe_"+this.selectedClass.toLowerCase()+".png"},getTypeImg:function(){return"type_"+this.selectedType.toLowerCase()+".png"},whenTypeSelected:function(){"Sort"===this.selectedType?(this.ATKText.visible=!1,this.HPText.visible=!1,this.MPText.visible=!1,this.vignette.y=VIGNETTE_Y-6,this.updateCropper()):(this.ATKText.visible=!0,this.HPText.visible=!0,this.MPText.visible=!0,this.vignette.y=VIGNETTE_Y),this.updateCardImage()},whenRaritySelected:function(){this.updateGemmeImage(),this.updateCardImage()},whenClassSelected:function(){this.updateCardImage()},getCardImgName:function(){return this.selectedRarity.toLowerCase().match("infinite")?this.selectedRarity.toLowerCase():this.selectedClass.toLowerCase()+"_"+this.selectedType.toLowerCase()+"_commune"},getGemmeImgName:function(){return this.selectedRarity.toLowerCase().match("infinite")?"gemme_commune":"gemme_"+this.selectedRarity.toLowerCase()},updateCardImage:function(){var b="img/cartes/"+this.getCardImgName()+".png";this.card.texture=PIXI.loader.resources[b].texture,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},updateGemmeImage:function(){var b="img/gemmes/"+this.getGemmeImgName()+".png";this.gemme.texture=PIXI.loader.resources[b].texture,this.gemme.x=NAME_X-this.gemme.width/2,this.gemme.y=b.includes("peu commune")?22:12,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenAPChanged:function(){this.APText.text=String(this.cardAP),this.cardAP>9?this.APText.x=AP_X-16:this.APText.x=AP_X,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenATKChanged:function(){this.ATKText.text=String(this.cardAtk),this.cardAtk>9?(this.ATKText.x=ATK_X-16,this.ATKText.y=ATK_Y+10,this.ATKText.style.fontSize="42px"):(this.ATKText.x=ATK_X,this.ATKText.y=ATK_Y,this.ATKText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenHPChanged:function(){this.HPText.text=String(this.cardHP),this.cardHP>9?(this.HPText.x=HP_X-16,this.HPText.y=HP_Y+10,this.HPText.style.fontSize="42px"):(this.HPText.x=HP_X,this.HPText.y=HP_Y,this.HPText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenMPChanged:function(){this.MPText.text=String(this.cardMP),this.cardMP>9?(this.MPText.x=MP_X-18,this.MPText.y=MP_Y+10,this.MPText.style.fontSize="42px"):(this.MPText.x=MP_X,this.MPText.y=MP_Y,this.MPText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenNameChanged:function(){this.NameText.text=this.cardName,this.NameText.x=NAME_X-this.NameText.width/2,this.NameText.y=NAME_Y,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenFamilyChanged:function(){this.FamilyText.text=this.cardFamily,this.FamilyText.x=NAME_X-this.FamilyText.width/2,this.FamilyText.y=FAMILY_Y,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},blankVignette:function(){this.vignette.visible=!1,this.showGameVignettes=!1,this.showCustomVignette=!1,this.renderer.render(this.stage)},gameVignettes:function(){this.showGameVignettes=!0,this.showCustomVignette=!1},customVignette:function(){this.showGameVignettes=!1,this.showCustomVignette=!0},loadVignettes:function(){for(var c=this,d=this.selectedVignetteCateg.toLowerCase(),e=document.getElementById("gameVignettes-row"),f=0;e.children.length>0;)e.removeChild(e.children[0]);if(this.cantLoadVignettes())return void this.vignettesTextures[d].forEach(function(a){var c=document.createElement("div");c.className="col-lg-2";var d=document.createElement("img");d.setAttribute("class","vignette-img"),d.setAttribute("src",a.path),c.appendChild(d),$(d).click(b.setGameVignette.bind(b,f+1)),e.appendChild(c),$(c).animateCss("fadeIn"),f++});this.vignettesTextures[d]=[];for(var g="img/vignettes/"+d+"/",h=this.getVignettesNumber(d),i=[],j=1;j<=h;j++)i.push(g+"v ("+j+").png");console.log("toLoad:",i),PIXI.loader.add(i).on("progress",function(a,g){var h=i[f];if(h){console.log("path:",h),c.vignettesTextures[d].push({texture:g,path:h});var j=document.createElement("div");j.className="col-lg-2";var k=document.createElement("img");k.setAttribute("class","vignette-img"),k.setAttribute("src",h),j.appendChild(k),$(k).click(b.setGameVignette.bind(b,f+1)),e.appendChild(j),$(j).animateCss("fadeIn"),f++,console.log("counter:",f)}}).load(function(){b.vignettesLoaded[d]=!0})},loadCustomVignette:function(){var b=this;PIXI.loader.add(this.vignetteCustomLink).load(function(){b.vignette.texture=PIXI.loader.resources[b.vignetteCustomLink].texture,b.vignette.visible=!0,b.renderer.render(b.stage),$("#render-div").animateCss("pulse")})},getVignettesNumber:function(b){switch(b){case"tokens":return 17;case"infinite":return 90;case"neutre":return 212;default:return 25}},setGameVignette:function(b){var c="img/vignettes/"+this.selectedVignetteCateg.toLowerCase()+"/",d=c+"v ("+b+").png";this.vignette.texture=PIXI.loader.resources[d].texture,this.vignette.visible=!0,this.lastVignetteIndex=b,this.updateCropper(),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},updateCropper:function(){b.cropper.visible=!1,this.vignette.mask=null,"Sort"===this.selectedType&&(b.cropper.position.x=this.vignette.x,b.cropper.position.y=this.vignette.y,b.cropper.scale.x=this.vignette.scale.x,b.cropper.scale.y=this.vignette.scale.y,b.cropper.visible=!0,this.vignette.mask=b.cropper)},cantLoadVignettes:function(){return!!this.vignettesLoaded[this.selectedVignetteCateg.toLowerCase()]},whenVignetteCoordsChanged:function(){this.updateCropper(),this.renderer.render(this.stage)},whenDescriptionChanged:function(){for(var b=this;this.descriptionContainer.children.length>0;)this.descriptionContainer.removeChild(this.descriptionContainer.children[0]);var c=this.cardDescription.split("\n"),d=0,e=0;c.forEach(function(a){d=0;var c=a.split(" "),f=[];c.forEach(function(a){var c=a.startsWith("*")&&a.endsWith("*");a=a.replace("*","").replace("*","");var g=new PIXI.Text(a,b.descriptionStyle(c));g.x=NAME_X+d,g.y=DESC_Y+e,b.descriptionContainer.addChild(g),d+=g.width+6,f.push(g)});var g=0;f.forEach(function(a){g+=a.width}),f.forEach(function(a){a.x-=g/2}),e+=25}),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},descriptionStyle:function(b){return{fontFamily:"Montserrat",fontSize:"28px",fontWeight:b?"bold":"400",fill:"#000"}},generate:function(){this.renderer.render(this.stage);var c=this.renderer.view.toDataURL(),d=document.getElementById("cardResult");d.src=c,$(d).animateCss("fadeIn"),b.fireDatabaseRef.once("value").then(function(a){var d=a.val().value,e=dataURItoBlob(c);b.fireStoragePics[d].put(e).then(function(a){b.fireDatabaseRef.set({value:4===d?0:d+1})})}).catch(function(a){var d=dataURItoBlob(c);b.fireStoragePics[0].put(d).then(function(a){b.fireDatabaseRef.set({value:0})})})},forceUpdateShowcase:function(){d()}}});b.fireDatabase=firebase.database(),b.fireDatabaseRef=b.fireDatabase.ref("picIndex"),b.fireDatabaseRef.on("value",function(){d()}),b.fireStorage=firebase.storage(),b.fireStorageRef=b.fireStorage.ref(),b.fireStoragePics={};for(var c=0;c<5;c++)b.fireStoragePics[c]=b.fireStorageRef.child("images/"+c+".png");d(),b.renderer=PIXI.autoDetectRenderer(446,566,{transparent:!0}),b.stage=new PIXI.Container,document.getElementById("render-div").appendChild(b.renderer.view);var f=[];b.classes.forEach(function(a){b.types.forEach(function(b){["Commune"].forEach(function(c){var d="img/cartes/"+a+"_"+b+"_"+c+".png";d=d.toLowerCase(),f.push(d)})})}),f.push("img/cartes/infinite nv1.png"),f.push("img/cartes/infinite nv2.png"),f.push("img/cartes/infinite nv3.png"),f.push("img/gemmes/gemme_commune.png"),f.push("img/gemmes/gemme_peu commune.png"),f.push("img/gemmes/gemme_rare.png"),f.push("img/gemmes/gemme_krosmique.png"),f.push("img/gemmes/gemme_infinite nv1.png"),f.push("img/gemmes/gemme_infinite nv2.png"),f.push("img/gemmes/gemme_infinite nv3.png"),f.push("img/vignettes/mask.png"),PIXI.loader.add(f).on("progress",function(a,c){b.bar.style.width=a.progress+"%"}).load(g)};
