"use strict";window.onload=function(){function c(){a.vignette=new PIXI.Sprite,a.card=new PIXI.Sprite(PIXI.loader.resources["img/cartes/neutre_créature_commune.png"].texture),a.gemme=new PIXI.Sprite,a.cropper=new PIXI.Sprite(PIXI.loader.resources["img/vignettes/mask.png"].texture),a.cropper.visible=!1,a.descriptionContainer=new PIXI.Container;var b={fontFamily:"BERNHC",fontSize:"72px",fontWeight:"bold",fill:"#FFF",stroke:"#04849A",strokeThickness:7};a.APText=new PIXI.Text("0",b),b.fontSize="52px",b.stroke="#895A00",b.strokeThickness=5,a.ATKText=new PIXI.Text("0",b),b.stroke="#8C0110",a.HPText=new PIXI.Text("0",b),b.stroke="#274600",a.MPText=new PIXI.Text("0",b),b={fontFamily:"BERNHC",fontSize:"36px",fontWeight:"bold",fill:"#FFF",stroke:"#000",strokeThickness:1,letterSpacing:1},a.NameText=new PIXI.Text("",b),b.fontSize="28px",a.FamilyText=new PIXI.Text("",b),a.stage.addChild(a.vignette),a.stage.addChild(a.cropper),a.stage.addChild(a.card),a.stage.addChild(a.gemme),a.stage.addChild(a.APText),a.stage.addChild(a.ATKText),a.stage.addChild(a.HPText),a.stage.addChild(a.MPText),a.stage.addChild(a.NameText),a.stage.addChild(a.FamilyText),a.stage.addChild(a.descriptionContainer),a.vignette.x=VIGNETTE_X,a.vignette.y=VIGNETTE_Y,a.vignette.scale.x=VIGNETTE_SX,a.vignette.scale.y=VIGNETTE_SY,a.card.scale.x=CARD_SX,a.card.scale.y=CARD_SY,a.APText.x=AP_X,a.APText.y=AP_Y,a.ATKText.x=ATK_X,a.ATKText.y=ATK_Y,a.HPText.x=HP_X,a.HPText.y=HP_Y,a.MPText.x=MP_X,a.MPText.y=MP_Y,a.gemme.scale.x=1.2,a.gemme.scale.y=1.2,a.updateCardImage(),a.updateGemmeImage(),a.loaded=!0,a.bar.remove()}VIGNETTE_X=66,VIGNETTE_Y=64,VIGNETTE_SX=1.87,VIGNETTE_SY=1.8,CARD_SX=.5,CARD_SY=.5,AP_X=54,AP_Y=40,ATK_X=312,ATK_Y=42,HP_X=372,HP_Y=42,MP_X=348,MP_Y=84,NAME_X=223,NAME_Y=314,FAMILY_Y=526,DESC_Y=380,$.fn.extend({animateCss:function(b){var c="webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend";this.addClass("animated "+b).one(c,function(){$(this).removeClass("animated "+b)})}});var a=new Vue({el:"#app",data:{loaded:!1,bar:document.getElementById("progress-bar"),vignetteBar:document.getElementById("progress-bar-v"),classes:["Neutre","Cra","Ecaflip","Eniripsa","Iop","Sacrieur","Sadida","Sram","Xelor"],rarities:["Commune","Peu commune","Rare","Krosmique","Infinite Nv1","Infinite Nv2","Infinite Nv3"],types:["Créature","Sort"],vignetteCategories:["Tokens","Neutre","Infinite","Cra","Ecaflip","Eniripsa","Iop","Sacrieur","Sadida","Sram","Xelor"],selectedType:"Créature",selectedRarity:"Commune",selectedClass:"Neutre",selectedVignetteCateg:"Tokens",selectedEffect:"",vignettesLoaded:{},vignette:{x:0,y:0,scale:{x:1,y:1}},vignettesTextures:{},vignetteCustomLink:"",cardName:"",cardExt:"",cardFamily:"",cardAtk:0,cardHP:0,cardMP:0,cardAP:0,cardDescription:"",showGameVignettes:!1,showCustomVignette:!1},methods:{getClassImg:function(){return"classe_"+this.selectedClass.toLowerCase()+".png"},getTypeImg:function(){return"type_"+this.selectedType.toLowerCase()+".png"},whenTypeSelected:function(){"Sort"===this.selectedType?(this.ATKText.visible=!1,this.HPText.visible=!1,this.MPText.visible=!1,this.vignette.y=VIGNETTE_Y-6,this.updateCropper()):(this.ATKText.visible=!0,this.HPText.visible=!0,this.MPText.visible=!0,this.vignette.y=VIGNETTE_Y),this.updateCardImage()},whenRaritySelected:function(){this.updateGemmeImage(),this.updateCardImage()},whenClassSelected:function(){this.updateCardImage()},getCardImgName:function(){return this.selectedRarity.toLowerCase().match("infinite")?this.selectedRarity.toLowerCase():this.selectedClass.toLowerCase()+"_"+this.selectedType.toLowerCase()+"_commune"},getGemmeImgName:function(){return this.selectedRarity.toLowerCase().match("infinite")?"gemme_commune":"gemme_"+this.selectedRarity.toLowerCase()},updateCardImage:function(){var b="img/cartes/"+this.getCardImgName()+".png";this.card.texture=PIXI.loader.resources[b].texture,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},updateGemmeImage:function(){var b="img/gemmes/"+this.getGemmeImgName()+".png";this.gemme.texture=PIXI.loader.resources[b].texture,this.gemme.x=NAME_X-this.gemme.width/2,this.gemme.y=b.includes("peu commune")?22:12,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenAPChanged:function(){this.APText.text=String(this.cardAP),this.cardAP>9?this.APText.x=AP_X-16:this.APText.x=AP_X,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenATKChanged:function(){this.ATKText.text=String(this.cardAtk),this.cardAtk>9?(this.ATKText.x=ATK_X-16,this.ATKText.y=ATK_Y+10,this.ATKText.style.fontSize="42px"):(this.ATKText.x=ATK_X,this.ATKText.y=ATK_Y,this.ATKText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenHPChanged:function(){this.HPText.text=String(this.cardHP),this.cardHP>9?(this.HPText.x=HP_X-16,this.HPText.y=HP_Y+10,this.HPText.style.fontSize="42px"):(this.HPText.x=HP_X,this.HPText.y=HP_Y,this.HPText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenMPChanged:function(){this.MPText.text=String(this.cardMP),this.cardMP>9?(this.MPText.x=MP_X-18,this.MPText.y=MP_Y+10,this.MPText.style.fontSize="42px"):(this.MPText.x=MP_X,this.MPText.y=MP_Y,this.MPText.style.fontSize="50px"),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenNameChanged:function(){this.NameText.text=this.cardName,this.NameText.x=NAME_X-this.NameText.width/2,this.NameText.y=NAME_Y,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},whenFamilyChanged:function(){this.FamilyText.text=this.cardFamily,this.FamilyText.x=NAME_X-this.FamilyText.width/2,this.FamilyText.y=FAMILY_Y,this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},blankVignette:function(){this.vignette.visible=!1,this.showGameVignettes=!1,this.showCustomVignette=!1,this.renderer.render(this.stage)},gameVignettes:function(){this.showGameVignettes=!0,this.showCustomVignette=!1},customVignette:function(){this.showGameVignettes=!1,this.showCustomVignette=!0},loadVignettes:function(){for(var c=this,d=this.selectedVignetteCateg.toLowerCase(),e=document.getElementById("gameVignettes-row"),f=0;e.children.length>0;)e.removeChild(e.children[0]);if(this.cantLoadVignettes())return void this.vignettesTextures[d].forEach(function(b){var c=document.createElement("div");c.className="col-lg-2";var d=document.createElement("img");d.setAttribute("class","vignette-img"),d.setAttribute("src",b.path),c.appendChild(d),$(d).click(a.setGameVignette.bind(a,f+1)),e.appendChild(c),$(c).animateCss("fadeIn"),f++});this.vignettesTextures[d]=[];for(var g="img/vignettes/"+d+"/",h=this.getVignettesNumber(d),i=[],j=1;j<=h;j++)i.push(g+"v ("+j+").png");console.log("toLoad:",i),PIXI.loader.add(i).on("progress",function(b,g){var h=i[f];if(h){console.log("path:",h),c.vignettesTextures[d].push({texture:g,path:h});var j=document.createElement("div");j.className="col-lg-2";var k=document.createElement("img");k.setAttribute("class","vignette-img"),k.setAttribute("src",h),j.appendChild(k),$(k).click(a.setGameVignette.bind(a,f+1)),e.appendChild(j),$(j).animateCss("fadeIn"),f++,console.log("counter:",f)}}).load(function(){a.vignettesLoaded[d]=!0})},loadCustomVignette:function(){var b=this;PIXI.loader.add(this.vignetteCustomLink).load(function(){b.vignette.texture=PIXI.loader.resources[b.vignetteCustomLink].texture,b.vignette.visible=!0,b.renderer.render(b.stage),$("#render-div").animateCss("pulse")})},getVignettesNumber:function(b){switch(b){case"tokens":return 17;case"infinite":return 90;case"neutre":return 212;default:return 25}},setGameVignette:function(b){var c="img/vignettes/"+this.selectedVignetteCateg.toLowerCase()+"/",d=c+"v ("+b+").png";this.vignette.texture=PIXI.loader.resources[d].texture,this.vignette.visible=!0,this.lastVignetteIndex=b,this.updateCropper(),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},updateCropper:function(){a.cropper.visible=!1,this.vignette.mask=null,"Sort"===this.selectedType&&(a.cropper.position.x=this.vignette.x,a.cropper.position.y=this.vignette.y,a.cropper.scale.x=this.vignette.scale.x,a.cropper.scale.y=this.vignette.scale.y,a.cropper.visible=!0,this.vignette.mask=a.cropper)},cantLoadVignettes:function(){return!!this.vignettesLoaded[this.selectedVignetteCateg.toLowerCase()]},whenVignetteCoordsChanged:function(){this.updateCropper(),this.renderer.render(this.stage)},whenDescriptionChanged:function(){for(var b=this;this.descriptionContainer.children.length>0;)this.descriptionContainer.removeChild(this.descriptionContainer.children[0]);var c=this.cardDescription.split("\n"),d=0,e=0;c.forEach(function(a){d=0;var c=a.split(" "),f=[];c.forEach(function(a){var c=a.startsWith("*")&&a.endsWith("*");a=a.replace("*","").replace("*","");var g=new PIXI.Text(a,b.descriptionStyle(c));g.x=NAME_X+d,g.y=DESC_Y+e,b.descriptionContainer.addChild(g),d+=g.width+6,f.push(g)});var g=0;f.forEach(function(a){g+=a.width}),f.forEach(function(a){a.x-=g/2}),e+=22}),this.renderer.render(this.stage),$("#render-div").animateCss("pulse")},descriptionStyle:function(b){return{fontFamily:"Montserrat",fontSize:"28px",fontWeight:b?"bold":"400",fill:"#000"}},generate:function(){this.renderer.render(this.stage);var b=this.renderer.view.toDataURL(),c=document.getElementById("cardResult");c.setAttribute("src",b),$(c).animateCss("fadeIn")}}});a.renderer=PIXI.autoDetectRenderer(446,566,{transparent:!0}),a.stage=new PIXI.Container,document.getElementById("render-div").appendChild(a.renderer.view);var b=[];a.classes.forEach(function(c){a.types.forEach(function(a){["Commune"].forEach(function(d){var e="img/cartes/"+c+"_"+a+"_"+d+".png";e=e.toLowerCase(),b.push(e)})})}),b.push("img/cartes/infinite nv1.png"),b.push("img/cartes/infinite nv2.png"),b.push("img/cartes/infinite nv3.png"),b.push("img/gemmes/gemme_commune.png"),b.push("img/gemmes/gemme_peu commune.png"),b.push("img/gemmes/gemme_rare.png"),b.push("img/gemmes/gemme_krosmique.png"),b.push("img/gemmes/gemme_infinite nv1.png"),b.push("img/gemmes/gemme_infinite nv2.png"),b.push("img/gemmes/gemme_infinite nv3.png"),b.push("img/vignettes/mask.png"),PIXI.loader.add(b).on("progress",function(b,c){a.bar.style.width=b.progress+"%"}).load(c)};
